def build(ctx):
  def injectpath(task):
    import re
    src = task.inputs[0].abspath()
    tgt = task.outputs[0].abspath() 
    f=open(src)
    txt = f.read()
    txt = re.sub("\$REPLACEPATH",ctx.env.PYTHONDIR,txt)
    txt = re.sub("\$PYTHONEXE",ctx.env.PYTHON[0],txt)
    f=open(tgt,"w")
    print >>f,txt,
    f.close()
    
  ctx.load("execconfig","waf_tools")
  if ctx.env.CYTHON:
    ctx(
      features = "c cshlib pyext",
      source = "clik/lkl.pyx",
      target  = "lkl",
      includes = "../src"+" ../src/minipmc/"*(not ctx.env.has_pmc),
      use = "clik",
      install_path = "${PYTHONDIR}/clik"
    )
  
  ctx(
    source = "clik/parobject.py clik/__init__.py",
    install_path = "${PYTHONDIR}/clik"
  )
  
  ctx(
    execrule = injectpath,
    source = "synthetic_smica.py",
    target = "synthetic_smica",
    install_path = ctx.env.BINDIR
    )    
  ctx(
    execrule = injectpath,
    source = "clik_example_py.py",
    target = "clik_example_py",
    install_path = ctx.env.BINDIR
    )    
  ctx(
    execrule = injectpath,
    source = "clik_join.py",
    target = "clik_join",
    install_path = ctx.env.BINDIR
    )    
  ctx(
    execrule = injectpath,
    source = "clik_disjoin.py",
    target = "clik_disjoin",
    install_path = ctx.env.BINDIR
    )    
  ctx(
    execrule = injectpath,
    source = "clik_print.py",
    target = "clik_print",
    install_path = ctx.env.BINDIR
    )    

  ctx(
    execrule = injectpath,
    source = "create_lowl_problem.py",
    target = "create_lowl_problem",
    install_path = ctx.env.BINDIR
    )    

  ctx(
    execrule = injectpath,
    source = "prepare_lowl.py",
    target = "prepare_lowl",
    install_path = ctx.env.BINDIR
    )    

  ctx(
    execrule = injectpath,
    source = "prepare_wmap.py",
    target = "prepare_wmap",
    install_path = ctx.env.BINDIR
    )    


